import streamlit as st
import pandas as pd
import json
import os
import time
import random
from datetime import datetime

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©
st.set_page_config(page_title="Ù†Ø¸Ø§Ù… Ø·Ø§Ù‚Ø© Ø§Ù„Ø£Ù†Ø¨Ø§Ø± - Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„", layout="wide")

DB_FILE = "anbar_grid_sync.json"

# --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø¢Øª ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø§Øª Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© ---
LOCATIONS = {
    "Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ": {"avg": 400, "priority": 10},
    "Ù…Ø¹Ù…Ù„ Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø±Ù…Ø§Ø¯ÙŠ": {"avg": 500, "priority": 10},
    "Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø£Ù†Ø¨Ø§Ø± (Ø§Ù„Ù…Ø¬Ù…Ø¹)": {"avg": 350, "priority": 8},
    "Ø­ÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ… (Ø§Ù„Ù…ØºØ°ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)": {"avg": 300, "priority": 7}
}

def load_data():
    if not os.path.exists(DB_FILE): return []
    try:
        with open(DB_FILE, "r") as f: return json.load(f)
    except: return []

def save_entry(name, current):
    history = load_data()
    avg = LOCATIONS[name]["avg"]
    if current < avg: status, level = "ğŸŸ¢ Ù…Ø³ØªÙ‚Ø±", 1
    elif avg <= current < (avg * 1.2): status, level = "ğŸŸ¡ ØªÙ†Ø¨ÙŠÙ‡", 2
    else: status, level = "ğŸ”´ Ø®Ø·Ø±", 3

    entry = {
        "Ø§Ù„Ù…Ù†Ø´Ø£Ø©": name,
        "Ø§Ù„ØªÙŠØ§Ø± (A)": current,
        "Ø§Ù„Ø­Ø§Ù„Ø©": status,
        "Ø§Ù„ÙˆÙ‚Øª": datetime.now().strftime("%H:%M:%S.%f")[:-3],
        "level": level,
        "p": LOCATIONS[name]["priority"]
    }
    history.append(entry)
    with open(DB_FILE, "w") as f: json.dump(history[-40:], f)

# --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙˆØ§
